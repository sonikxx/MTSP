<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTSP Problem Solver</title>
    <link rel="stylesheet" href="../css/main_style.css">
</head>
<body>
<div class="container">
    <header>
        <h1>Multiple Traveling Salesman Problem (MTSP)</h1>
        <p>Click on the map to add cities to the route and solve the MTSP efficiently.</p>
    </header>

    <section class="content">
        <canvas id="map"></canvas>
        <button id="solveMTSPButton">Solve MTSP</button>

        <div class="coordinates">
            <h3>Added Cities:</h3>
            <ul id="cityList"></ul>
        </div>
    </section>
</div>


<script src="../js/graph.js"></script>
<script src="../js/script.js"></script>
<script>
    const graphDrawer = new GraphDrawer('map');
    document.getElementById('solveMTSPButton').addEventListener('click', async function() {
        if (graphDrawer.points.length < 2) {
            console.log("Please add at least two cities to solve the problem.");
            return;
        }
        graphDrawer.clearRoutes();

        const response = await fetch('/protected/v1/solve', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ salesmanNumber: 2, cities: graphDrawer.points })
        });

        if (response.ok) {
            const result = await response.json();
            console.log("requestId is: " + result.requestId);
            startPoling(result.requestId,
                // on Intermediate
                data => {
                    console.log("Receiving solution:", data);
                    graphDrawer.setRoutes(data.routes);
                },
                // on Success
                data => {
                    console.log("Received solution:", data);
                    graphDrawer.setRoutes(data.routes);
                });
        } else {
            alert("Error solving MTSP.");
        }
    });
</script>

</body>
</html>
