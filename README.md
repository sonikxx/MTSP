# Веб-сервис решения задачи нескольких коммивояжеров (MTSP)

Данный проект представляет собой веб-сервис для решения задачи нескольких коммивояжеров (Multiple Traveling Salesman Problem, MTSP). Разработан на языке Kotlin с использованием микросервисной архитектуры и предоставляет REST API для взаимодействия. Сервис поддерживает асинхронное вычисление результатов, хранение истории решений и механизм ограничения частоты запросов.

## Оглавление
1. [Краткое описание](#краткое-описание)
2. [Основные особенности](#основные-особенности)
3. [Технологический стек](#технологический-стек)
4. [Установка и запуск](#установка-и-запуск)
5. [Использование](#использование)
   - [Работа с картами](#работа-с-картами)
   - [Постановка задачи на решение MTSP](#постановка-задачи-на-решение-mtsp)
   - [Получение результатов](#получение-результатов)
6. [Веб интерфейс](#веб-интерфейс)

## Краткое описание
Проект решает классическую задачу нескольких коммивояжеров (MTSP):
 - Заданы несколько коммивояжеров.
 - Требуется распределить множество точек между агентами таким образом, чтобы суммарное расстояние было минимальным.
   
Система реализована в виде набора микросервисов (API, Solver и RPS Limiter). Пользователи могут создавать карты (наборы точек, матрицы расстояний), задавать параметры алгоритма и получать решения с отображением маршрутов.

## Основные особенности
1. Поддержка нескольких алгоритмов для решения задачи MTSP.
2. Асинхронные вычисления: запрос на решение задачи не блокирует UI, а обрабатывается в фоне.
3. Микросервисная архитектура: сервисы API, Solver и RPS Limiter могут масштабироваться независимо.
4. REST API с аутентификацией и авторизацией.
5. Хранение и просмотр истории запросов и результатов.
6. Визуальное представление маршрутов на карте и управление параметрами решения.
7. Возможность прерывания задач.

## Технологический стек

- Язык разработки:
  – Kotlin
  – JavaScript

- Фреймворки и библиотеки:
  – Spring Boot
  – Apache Kafka
  – PostgreSQL

- Прочее:
  – Gradle/Maven
  – Docker
  – Google reCAPTCHA

## Установка и запуск

1. **Клонирование репозитория**:
   ```
   git clone https://github.com/sonikxx/MTSP.git
   cd MTSP
   ```

2. **Настройка окружения** (при необходимости):\
   убедитесь, что установлен Docker и Docker Compose (или установите PostgreSQL, Kafka, ZooKeeper вручную).

3. **Запуск Kafka**:
   ```
   docker-compose up -d
   ```
4. **Запуск сервисов**:\
    из директории сервисов API и Solver выполнить:
   ```
   ./gradlew bootRun
   ```

5. **Открыть UI**:\
   API-сервис доступен по адресу http://localhost:8080


## Использование

### Работа с картами

- POST /protected/v1/save/map - cоздать новую карту
  - Возвращает id карты
  - В теле передаются название, флаг приватности (public или private), а также список точек/матрица расстояний (JSON).
  - Пример запроса:
      ```
      {
        "name": "Map 1",
        "isPrivate": false,
        "points": [
          {
            "name": "Point 1",
            "lat": 55.75,
            "lon": 37.62
          },
          {
            "name": "Point 2",
            "lat": 55.76,
            "lon": 37.63
          }
        ],
        distances: [
          [0, 10],
          [10, 0]
        ]
      }
      ```

- GET /protected/v1/maps - получить список id доступных карт (собственные + публичные)
- GET /protected/v1/map/{mapId} - получить детальную информацию о карте
  
### Постановка задачи на решение MTSP

- POST /protected/v1/solve - решить задачу
  - В ответ клиент получает уникальный идентификатор задачи - requestId
  - В теле передаются id карты, количество коммивояжеров, название алгоритма, дополнительные параметры алгоритма (например, максимальное число итераций)
  - Пример тела запроса:
     ```
     {
       "mapId": "1234567890",
       "agentsCount": 2,
       "algorithm": "BruteForce",
       "params": {
         "maxIterations": 1000
       }
     }
     ```


### Получение результатов

- GET /protected/v1/result/{requestId} - проверить статус и результат задачи. В ответе на такой запрос будет поле status, принимающее одно из следующих значений:
    - QUEUED — задача в очереди на выполнение
    - INTERMEDIATE — задача находится в процессе решения, возвращаемый результат является лучшим на данный момент
    - SOLVED — задача успешно решена
    - FAILED — во время вычислений произошел сбой, задача не будет выполнена
- DELETE /protected/v1/solve/{requestId} - прервать выполнение
- GET /protected/v1/best/{mapId} - показать лучшее решение для конкретной карты
  - В ответ клиент получает набор маршрутов для коммивояжеров, суммарная стоимость, название алгоритма и время его работы

## Веб интерфейс
